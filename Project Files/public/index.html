<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="/Styles/style.css" rel="stylesheet">
    <link type="text/css" href="https://fonts.googleapis.com/css?family=Raleway|Roboto" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr"
        crossorigin="anonymous">
    <title>Project DAW</title>
</head>

<body>
    <div class="header container">
        <h3>Project DAW</h3>
        <div class="stay-right">
            <a>Login</a>
            <a>Register</a>
        </div>
    </div>
    <div id="main-body" class="container">
        <div class="sound-line container">
            <h3 class="sound-name">Bass Guitar</h3>
            <div id="row1 col1" class="sound-btn dark-btn"></div>
            <div id="row1 col2" class="sound-btn light-btn"></div>
            <div id="row1 col3" class="sound-btn dark-btn"></div>
            <div id="row1 col4" class="sound-btn light-btn"></div>
            <div id="row1 col5" class="sound-btn dark-btn">
            </div>
            <div id="row1 col6" class="sound-btn light-btn"></div>
            <div id="row1 col7" class="sound-btn dark-btn">
            </div>
            <div id="row1 col8" class="sound-btn light-btn"></div>
        </div>
        <div class="sound-line container">
            <h3 class="sound-name">Drum Loop</h3>
            <div id="row2 col1" class="sound-btn light-btn"></div>
            <div id="row2 col2" class="sound-btn dark-btn"></div>
            <div id="row2 col3" class="sound-btn light-btn"></div>
            <div id="row2 col4" class="sound-btn dark-btn"></div>
            <div id="row2 col5" class="sound-btn light-btn"></div>
            <div id="row2 col6" class="sound-btn dark-btn"></div>
            <div id="row2 col7" class="sound-btn light-btn"></div>
            <div id="row2 col8" class="sound-btn dark-btn"></div>
        </div>
        <div class="sound-line container">
            <h3 class="sound-name">Piano Solo</h3>
            <div id="row3 col1" class="sound-btn dark-btn"></div>
            <div id="row3 col2" class="sound-btn light-btn"></div>
            <div id="row3 col3" class="sound-btn dark-btn"></div>
            <div id="row3 col4" class="sound-btn light-btn"></div>
            <div id="row3 col5" class="sound-btn dark-btn"></div>
            <div id="row3 col6" class="sound-btn light-btn"></div>
            <div id="row3 col7" class="sound-btn dark-btn"></div>
            <div id="row3 col8" class="sound-btn light-btn"></div>
        </div>
        <div class="sound-line container">
            <h3 class="sound-name">Vocal Progression</h3>
            <div id="row4 col1" class="sound-btn light-btn"></div>
            <div id="row4 col2" class="sound-btn dark-btn"></div>
            <div id="row4 col3" class="sound-btn light-btn"></div>
            <div id="row4 col4" class="sound-btn dark-btn"></div>
            <div id="row4 col5" class="sound-btn light-btn"></div>
            <div id="row4 col6" class="sound-btn dark-btn"></div>
            <div id="row4 col7" class="sound-btn light-btn"></div>
            <div id="row4 col8" class="sound-btn dark-btn"></div>
        </div>
        <div class="edit-line container">
            <div id="edit" class="edit-btn">Edit</div>
        </div>
    </div>
    <div id="footer" class="container">
        <h6 id="copyright">Â© Austin Sigler - All Rights Reserved</h6>
        <div class="icon-container">
            <i id="play-pause" class="fas fa-play fa-2x"></i>
            <i id="stop" class="fas fa-stop fa-2x"></i>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.1.1/howler.js"></script>
    <script>
        // let initialSounds = [];
        let sounds = [];
        let col1Sounds = [];
        let col2Sounds = [];
        let col3Sounds = [];
        let col4Sounds = [];
        let col5Sounds = [];
        let col6Sounds = [];
        let col7Sounds = [];
        let col8Sounds = [];
        let sound = "";
        let soundsToPlay = [];

        const checkRow = btn => {
            if (sound == "") {
                if (btn.target.id[3] == 1) {
                    sound = new Howl({
                        src: ["/Audio_Files/BassSound.wav"]
                    });
                } else if (btn.target.id[3] == 2) {
                    sound = new Howl({
                        src: ["/Audio_Files/DrumLoop.wav"]
                    });
                } else if (btn.target.id[3] == 3) {
                    sound = new Howl({
                        src: ["/Audio_Files/PianoThing.wav"]
                    });
                } else {
                    sound = new Howl({
                        src: ["/Audio_Files/VocalThing.wav"]
                    });
                }
                // console.log(sound);
                addToInitialSoundsList(sound, btn.target.id[btn.target.id.length - 1]);
                sound = "";
            }
            btn.target.classList.toggle("selected");
            // console.log(`${btn.target.id[3]}`);
        }

        const addToInitialSoundsList = (sound, colIndex) => {
            sounds.push({
                "Column": colIndex,
                "Sound": sound
            });
            // console.log(sounds);
        }

        const sortSoundsInOrder = () => {
            sounds.sort(function (a, b) {
                return a.Column - b.Column;
            });
            console.log(sounds);
            setUpFirstSounds();
        }

        const setUpFirstSounds = () => {
            sounds.forEach(function (song) {
                if (song.Column == 1) {
                    col1Sounds.push(song);
                } else if (song.Column == 2) {
                    col2Sounds.push(song);
                } else if (song.Column == 3) {
                    col3Sounds.push(song);
                } else if (song.Column == 4) {
                    col4Sounds.push(song);
                } else if (song.Column == 5) {
                    col5Sounds.push(song);
                } else if (song.Column == 6) {
                    col6Sounds.push(song);
                } else if (song.Column == 7) {
                    col7Sounds.push(song);
                } else {
                    col8Sounds.push(song);
                }
            });

            setPlayOrder();
            // let index = 0;
            // songToPlay = sounds[0].Sound;
            // sounds.forEach(function (song) {
            //     if (index < sounds.length) {
            //         song.Sound.on('end', function () {
            //             if (index + 1 < sounds.length) {
            //                 songToPlay = sounds[index + 1].Sound;
            //                 index++;
            //                 // console.log(songToPlay);
            //                 // playSong(songToPlay);
            //             } else {
            //                 playPauseBTN.className = '';
            //                 playPauseBTN.className = `fas fa-play fa-2x`;
            //             }
            //         });
            //     }
            // });
            // sounds[sounds.length - 1].Sound.on('end', function () {
            //     playPauseBTN.className = '';
            //     playPauseBTN.className = `fas fa-play fa-2x`;

            // })
        }

        const setPlayOrder = () => {
            for (let i = 1; i < 9; i++) {
                if (i == 1) {
                    let duration = 0;
                    let index = 0;
                    for (let j = 0; j < col1Sounds.length; j++) {
                        soundDuration = checkDuration(col1Sounds[j].Sound);
                        if (soundDuration > duration) {
                            duration = soundDuration;
                            index = j;
                        }
                    }

                    if (col1Sounds.length > 0) {
                        col1Sounds[index].Sound.on('end', function () {
                            soundsToPlay = col2Sounds
                            playSong(soundsToPlay);
                        });
                    }
                    console.log(`Longest Col1 Sound is ${duration} at index ${index}`);
                } else if (i == 2) {
                    let duration = 0;
                    let index = 0;
                    for (let j = 0; j < col2Sounds.length; j++) {
                        soundDuration = checkDuration(col2Sounds[j].Sound);
                        if (soundDuration > duration) {
                            duration = soundDuration;
                            index = j;
                        }
                    }

                    if (col2Sounds.length > 0) {
                        col2Sounds[index].Sound.on('end', function () {
                            soundsToPlay = col3Sounds
                            playSong(soundsToPlay);
                        });
                    }
                    console.log(`Longest Col2 Sound is ${duration} at index ${index}`);
                } else if (i == 3) {
                    let duration = 0;
                    let index = 0;
                    for (let j = 0; j < col3Sounds.length; j++) {
                        soundDuration = checkDuration(col3Sounds[j].Sound);
                        if (soundDuration > duration) {
                            duration = soundDuration;
                            index = j;
                        }
                    }

                    if (col3Sounds.length > 0) {
                        col3Sounds[index].Sound.on('end', function () {
                            soundsToPlay = col4Sounds
                            playSong(soundsToPlay);
                        });
                    }
                    console.log(`Longest Col3 Sound is ${duration} at index ${index}`);
                } else if (i == 4) {
                    let duration = 0;
                    let index = 0;
                    for (let j = 0; j < col4Sounds.length; j++) {
                        soundDuration = checkDuration(col4Sounds[j].Sound);
                        if (soundDuration > duration) {
                            duration = soundDuration;
                            index = j;
                        }
                    }

                    if (col4Sounds.length > 0) {
                        col4Sounds[index].Sound.on('end', function () {
                            soundsToPlay = col5Sounds
                            playSong(soundsToPlay);
                        });
                    }
                    console.log(`Longest Col4 Sound is ${duration} at index ${index}`);
                } else if (i == 5) {
                    let duration = 0;
                    let index = 0;
                    for (let j = 0; j < col5Sounds.length; j++) {
                        soundDuration = checkDuration(col5Sounds[j].Sound);
                        if (soundDuration > duration) {
                            duration = soundDuration;
                            index = j;
                        }
                    }

                    if (col5Sounds.length > 0) {
                        col5Sounds[index].Sound.on('end', function () {
                            soundsToPlay = col6Sounds
                            playSong(soundsToPlay);
                        });
                    }
                    console.log(`Longest Col5 Sound is ${duration} at index ${index}`);
                } else if (i == 6) {
                    let duration = 0;
                    let index = 0;
                    for (let j = 0; j < col6Sounds.length; j++) {
                        soundDuration = checkDuration(col6Sounds[j].Sound);
                        if (soundDuration > duration) {
                            duration = soundDuration;
                            index = j;
                        }
                    }

                    if (col6Sounds.length > 0) {
                        col6Sounds[index].Sound.on('end', function () {
                            soundsToPlay = col7Sounds
                            playSong(soundsToPlay);
                        });
                    }
                    console.log(`Longest Col6 Sound is ${duration} at index ${index}`);
                } else if (i == 7) {
                    let duration = 0;
                    let index = 0;
                    for (let j = 0; j < col7Sounds.length; j++) {
                        soundDuration = checkDuration(col7Sounds[j].Sound);
                        if (soundDuration > duration) {
                            duration = soundDuration;
                            index = j;
                        }
                    }

                    if (col7Sounds.length > 0) {
                        col7Sounds[index].Sound.on('end', function () {
                            soundsToPlay = col8Sounds
                            playSong(soundsToPlay);
                        });
                    }
                    console.log(`Longest Col7 Sound is ${duration} at index ${index}`);
                } else if (i == 8) {
                    let duration = 0;
                    let index = 0;
                    for (let j = 0; j < col8Sounds.length; j++) {
                        soundDuration = checkDuration(col8Sounds[j].Sound);
                        if (soundDuration > duration) {
                            duration = soundDuration;
                            index = j;
                        }
                    }

                    if (col8Sounds.length > 0) {
                        col8Sounds[index].Sound.on('end', function () {
                            playPauseBTN.className = '';
                            playPauseBTN.className = `fas fa-play fa-2x`;
                        });
                    }
                    console.log(`Longest Col8 Sound is ${duration} at index ${index}`);
                }
            }

            soundsToPlay = col1Sounds;
        }

        const checkDuration = soundBit => {
            console.log(soundBit._duration);
            return soundBit._duration;
        }

        const addRemoveListener = mode => {
            for (let index = 1; index < 5; index++) {
                for (let secondIndex = 1; secondIndex < 9; secondIndex++) {
                    button = document.getElementById(`row${index} col${secondIndex}`)
                    // console.log(button);
                    button.classList.toggle('hover');
                    // var checkRowListener = checkRow.bind(null, button);
                    if (mode == 'add') {
                        if (button.classList.contains('selected')) {
                            button.classList.remove('selected');
                        }
                        sounds = [];
                        col1Sounds = [];
                        col2Sounds = [];
                        col3Sounds = [];
                        col4Sounds = [];
                        col5Sounds = [];
                        col6Sounds = [];
                        col7Sounds = [];
                        col8Sounds = [];
                        button.addEventListener('click', checkRow);
                    } else {
                        button.removeEventListener('click', checkRow);
                        // console.log(button);
                    }
                }
            }
        }

        const editBTN = document.getElementById("edit");
        editBTN.addEventListener('click', function () {
            if (editBTN.innerHTML == "Edit") {
                editBTN.innerHTML = "Done";
                addRemoveListener('add');
            } else {
                editBTN.innerHTML = "Edit";
                addRemoveListener('remove');
                sortSoundsInOrder();
            }
        });

        // Set up boolean to see what col array to pass into the playSong function
        const doEverything = () => {
            if (playPauseBTN.className == `fas fa-play fa-2x`) {
                playPauseBTN.className = '';
                playPauseBTN.className = `fas fa-pause fa-2x`;
                playSong(soundsToPlay);
                // console.log(sounds);
            } else {
                playPauseBTN.className = '';
                playPauseBTN.className = `fas fa-play fa-2x`;
                // console.log(songToPlay);
                pauseSong(soundsToPlay);
            }
        }

        const playSong = array => {
            array.forEach(function (sound) {
                sound.Sound.play();
            })
        }

        const pauseSong = array => {
            // console.log('Song paused');
            // isPaused = true;
            array.forEach(function (sound) {
                if (sound.Sound.playing()) {
                    sound.Sound.pause();
                }
            })
        }

        const stopSong = array => {
            array.forEach(function (sound) {
                sound.Sound.stop();
            })
            // isPaused = false;
            // songToPlay = sounds[0].Sound;
            soundsToPlay = col1Sounds;
        }

        document.body.onkeypress = function (evt) {
            if (evt.keyCode == 32) {
                doEverything();
            }
        }

        var playPauseBTN = document.getElementById(`play-pause`);
        playPauseBTN.addEventListener('click', doEverything);

        var stopBTN = document.getElementById(`stop`);
        stopBTN.addEventListener('click', function (evt) {
            playPauseBTN.className = '';
            playPauseBTN.className = `fas fa-play fa-2x`;
            stopSong(soundsToPlay);
        })
    </script>
</body>

</html>