<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="/Styles/style.css" rel="stylesheet">
    <link type="text/css" href="https://fonts.googleapis.com/css?family=Raleway|Roboto" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr"
        crossorigin="anonymous">
    <title>Project DAW</title>
</head>

<body>
    <div class="header container">
        <h3>Project DAW</h3>
        <div class="stay-right">
            <a>Login</a>
            <a>Register</a>
        </div>
    </div>
    <div id="main-body" class="container">
        <div class="sound-line container">
            <h3 class="sound-name">Bass Guitar</h3>
            <div id="row1 col1" class="sound-btn dark-btn"></div>
            <div id="row1 col2" class="sound-btn light-btn"></div>
            <div id="row1 col3" class="sound-btn dark-btn"></div>
            <div id="row1 col4" class="sound-btn light-btn"></div>
            <div id="row1 col5" class="sound-btn dark-btn">
            </div>
            <div id="row1 col6" class="sound-btn light-btn"></div>
            <div id="row1 col7" class="sound-btn dark-btn">
            </div>
            <div id="row1 col8" class="sound-btn light-btn"></div>
        </div>
        <div class="sound-line container">
            <h3 class="sound-name">Drum Loop</h3>
            <div id="row2 col1" class="sound-btn light-btn"></div>
            <div id="row2 col2" class="sound-btn dark-btn"></div>
            <div id="row2 col3" class="sound-btn light-btn"></div>
            <div id="row2 col4" class="sound-btn dark-btn"></div>
            <div id="row2 col5" class="sound-btn light-btn"></div>
            <div id="row2 col6" class="sound-btn dark-btn"></div>
            <div id="row2 col7" class="sound-btn light-btn"></div>
            <div id="row2 col8" class="sound-btn dark-btn"></div>
        </div>
        <div class="sound-line container">
            <h3 class="sound-name">Piano Solo</h3>
            <div id="row3 col1" class="sound-btn dark-btn"></div>
            <div id="row3 col2" class="sound-btn light-btn"></div>
            <div id="row3 col3" class="sound-btn dark-btn"></div>
            <div id="row3 col4" class="sound-btn light-btn"></div>
            <div id="row3 col5" class="sound-btn dark-btn"></div>
            <div id="row3 col6" class="sound-btn light-btn"></div>
            <div id="row3 col7" class="sound-btn dark-btn"></div>
            <div id="row3 col8" class="sound-btn light-btn"></div>
        </div>
        <div class="sound-line container">
            <h3 class="sound-name">Vocal Progression</h3>
            <div id="row4 col1" class="sound-btn light-btn"></div>
            <div id="row4 col2" class="sound-btn dark-btn"></div>
            <div id="row4 col3" class="sound-btn light-btn"></div>
            <div id="row4 col4" class="sound-btn dark-btn"></div>
            <div id="row4 col5" class="sound-btn light-btn"></div>
            <div id="row4 col6" class="sound-btn dark-btn"></div>
            <div id="row4 col7" class="sound-btn light-btn"></div>
            <div id="row4 col8" class="sound-btn dark-btn"></div>
        </div>
        <div class="edit-line container">
            <div id="edit" class="edit-btn">Edit</div>
        </div>
    </div>
    <div id="footer" class="container">
        <h6 id="copyright">Â© Austin Sigler - All Rights Reserved</h6>
        <div class="icon-container">
            <i id="play-pause" class="fas fa-play fa-2x"></i>
            <i id="stop" class="fas fa-stop fa-2x"></i>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.1.1/howler.js"></script>
    <script>
        var sounds = [];
        let sound = "";
        let isPaused = false;
        let songToPlay = '';

        const checkRow = btn => {
            if (sound == "") {
                if (btn.target.id[3] == 1) {
                    sound = new Howl({
                        src: ["/Audio_Files/BassSound.wav"]
                    });
                } else if (btn.target.id[3] == 2) {
                    sound = new Howl({
                        src: ["/Audio_Files/DrumLoop.wav"]
                    });
                } else if (btn.target.id[3] == 3) {
                    sound = new Howl({
                        src: ["/Audio_Files/PianoThing.wav"]
                    });
                } else {
                    sound = new Howl({
                        src: ["/Audio_Files/VocalThing.wav"]
                    });
                }
                console.log(sound);
                sounds.push(sound);
                sound = "";
            }
            btn.target.classList.toggle("selected");
            // console.log(`${btn.target.id[3]}`);
        }


        const addRemoveListener = mode => {
                for (let index = 1; index < 5; index++) {
                    for (let secondIndex = 1; secondIndex < 9; secondIndex++) {
                        button = document.getElementById(`row${index} col${secondIndex}`)
                        // console.log(button);
                        button.classList.toggle('hover');
                        // var checkRowListener = checkRow.bind(null, button);
                        if(mode == 'add'){
                            button.addEventListener('click', checkRow);
                        } else {
                            button.removeEventListener('click', checkRow);
                            // console.log(button);
                        }
                    }
                }
        }

        const editBTN = document.getElementById("edit");
        editBTN.addEventListener('click', function(){
            if(editBTN.innerHTML == "Edit") {
                editBTN.innerHTML = "Done";
                addRemoveListener('add');
            } else {
                editBTN.innerHTML = "Edit";
                addRemoveListener('remove');
            }
        });
        

        const doEverything = () => {
            if (playPauseBTN.className == `fas fa-play fa-2x`) {
                playPauseBTN.className = '';
                playPauseBTN.className = `fas fa-pause fa-2x`;
                if (sounds.length > 0) {
                    let index = 0;
                    if (!isPaused) {
                        songToPlay = sounds[0];
                    } else {
                        isPaused = false;
                    }
                    sounds.forEach(function (song) {
                        if (index < sounds.length) {
                            song.on('end', function () {
                                if (index + 1 < sounds.length) {
                                    songToPlay = sounds[index + 1];
                                    index++;
                                    console.log(songToPlay);
                                    playSong(songToPlay);
                                } else {
                                    playPauseBTN.className = '';
                                    playPauseBTN.className = `fas fa-play fa-2x`;
                                }
                            });
                        }
                    });
                    sounds[sounds.length - 1].on('end', function () {
                        playPauseBTN.className = '';
                        playPauseBTN.className = `fas fa-play fa-2x`;
                    })
                    console.log(songToPlay);
                    playSong(songToPlay);
                }
                console.log(sounds);
            } else {
                playPauseBTN.className = '';
                playPauseBTN.className = `fas fa-play fa-2x`;
                console.log(songToPlay);
                pauseSong(songToPlay);
            }
        }

        const playSong = song => {
            song.play();
        }

        const pauseSong = song => {
            console.log('Song paused');
            isPaused = true;
            song.pause();
        }

        const stopSong = song => {
            song.stop();
            isPaused = false;
        }

        document.body.onkeypress = function (evt) {
            if (evt.keyCode == 32) {
                doEverything();
            }
        }
        
        var playPauseBTN = document.getElementById(`play-pause`);
        playPauseBTN.addEventListener('click', doEverything);

        var stopBTN = document.getElementById(`stop`);
        stopBTN.addEventListener('click', function (evt) {
            playPauseBTN.className = '';
            playPauseBTN.className = `fas fa-play fa-2x`;
            stopSong(songToPlay);
        })
    </script>
</body>

</html>